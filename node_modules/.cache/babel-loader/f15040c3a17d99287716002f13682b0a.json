{"ast":null,"code":"import _regeneratorRuntime from\"/Users/usuario/Desktop/portfolio-cliente-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/usuario/Desktop/portfolio-cliente-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/usuario/Desktop/portfolio-cliente-main/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{useReducer}from\"react\";import authContext from\"./authContext\";import authReducer from\"./authReducer\";import clienteAxios from\"../../service/axios\";import tokenAuth from\"../../config/token\";import{REGISTRO_EXITOSO,REGISTRO_ERROR,LOGIN_EXITOSO,LOGIN_ERROR,LOGOUT,OBTENER_USUARIO}from\"../../types\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),autenticado:null,usuario:null,mensaje:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// 1. Registra al nuevo usuario\nvar registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var resultado,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post(\"/users\",datos);case 3:resultado=_context.sent;// Estoy enviando el TOKEN\ndispatch({type:REGISTRO_EXITOSO,payload:resultado.data});usuarioAutenticado();_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);alerta={msg:_context.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:REGISTRO_ERROR,payload:alerta});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();// 2. Retorna el usuario autenticado\nvar usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem(\"token\");if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get(\"/auth\");case 5:respuesta=_context2.sent;dispatch({type:OBTENER_USUARIO,payload:respuesta.data});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);dispatch({type:LOGIN_ERROR});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();// 3. Iniciar Sesi贸n\nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post(\"/auth\",datos);case 3:respuesta=_context3.sent;dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});// Traigo el usuario\nusuarioAutenticado();_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);alerta={msg:_context3.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:LOGIN_ERROR,payload:alerta});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();// 4. Cerrar Sesi贸n\nvar cerrarSesion=function cerrarSesion(){dispatch({type:LOGOUT});};return/*#__PURE__*/_jsx(authContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,registrarUsuario:registrarUsuario,usuarioAutenticado:usuarioAutenticado,iniciarSesion:iniciarSesion,cerrarSesion:cerrarSesion},children:props.children});};export default AuthState;","map":{"version":3,"sources":["/Users/usuario/Desktop/portfolio-cliente-main/src/context/auth/authState.js"],"names":["React","useReducer","authContext","authReducer","clienteAxios","tokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","LOGIN_EXITOSO","LOGIN_ERROR","LOGOUT","OBTENER_USUARIO","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","state","dispatch","registrarUsuario","datos","post","resultado","type","payload","data","usuarioAutenticado","alerta","msg","response","categoria","get","respuesta","iniciarSesion","cerrarSesion","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from \"react\";\r\nimport authContext from \"./authContext\";\r\nimport authReducer from \"./authReducer\";\r\n\r\nimport clienteAxios from \"../../service/axios\";\r\n\r\nimport tokenAuth from \"../../config/token\";\r\n\r\nimport {\r\n  REGISTRO_EXITOSO,\r\n  REGISTRO_ERROR,\r\n  LOGIN_EXITOSO,\r\n  LOGIN_ERROR,\r\n  LOGOUT,\r\n  OBTENER_USUARIO,\r\n} from \"../../types\";\r\n\r\nconst AuthState = (props) => {\r\n  const initialState = {\r\n    token: localStorage.getItem(\"token\"),\r\n    autenticado: null,\r\n    usuario: null,\r\n    mensaje: null,\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  // 1. Registra al nuevo usuario\r\n  const registrarUsuario = async (datos) => {\r\n    try {\r\n      const resultado = await clienteAxios.post(\"/users\", datos);\r\n\r\n      // Estoy enviando el TOKEN\r\n      dispatch({\r\n        type: REGISTRO_EXITOSO,\r\n        payload: resultado.data,\r\n      });\r\n\r\n      usuarioAutenticado();\r\n    } catch (error) {\r\n      const alerta = {\r\n        msg: error.response.data.msg,\r\n        categoria: \"alerta-error\",\r\n      };\r\n\r\n      dispatch({\r\n        type: REGISTRO_ERROR,\r\n        payload: alerta,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 2. Retorna el usuario autenticado\r\n  const usuarioAutenticado = async () => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      tokenAuth(token);\r\n    }\r\n\r\n    try {\r\n      const respuesta = await clienteAxios.get(\"/auth\");\r\n      dispatch({\r\n        type: OBTENER_USUARIO,\r\n        payload: respuesta.data,\r\n      });\r\n    } catch (error) {\r\n      dispatch({\r\n        type: LOGIN_ERROR,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 3. Iniciar Sesi贸n\r\n\r\n  const iniciarSesion = async (datos) => {\r\n    try {\r\n      const respuesta = await clienteAxios.post(\"/auth\", datos);\r\n\r\n      dispatch({\r\n        type: LOGIN_EXITOSO,\r\n        payload: respuesta.data,\r\n      });\r\n\r\n      // Traigo el usuario\r\n      usuarioAutenticado();\r\n    } catch (error) {\r\n      const alerta = {\r\n        msg: error.response.data.msg,\r\n        categoria: \"alerta-error\",\r\n      };\r\n\r\n      dispatch({\r\n        type: LOGIN_ERROR,\r\n        payload: alerta,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 4. Cerrar Sesi贸n\r\n  const cerrarSesion = () => {\r\n    dispatch({\r\n      type: LOGOUT,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <authContext.Provider\r\n      value={{\r\n        token: state.token,\r\n        autenticado: state.autenticado,\r\n        usuario: state.usuario,\r\n        mensaje: state.mensaje,\r\n        registrarUsuario,\r\n        usuarioAutenticado,\r\n        iniciarSesion,\r\n        cerrarSesion,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </authContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthState;\r\n"]},"metadata":{},"sourceType":"module"}