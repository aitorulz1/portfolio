{"ast":null,"code":"import _regeneratorRuntime from\"/Users/usuario/Desktop/portfolio-aa/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/usuario/Desktop/portfolio-aa/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/usuario/Desktop/portfolio-aa/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useReducer}from\"react\";import authContext from\"./authContext\";import authReducer from\"./authReducer\";import clienteAxios from\"../../service/axios\";import tokenAuth from\"../../config/token\";import{REGISTRO_EXITOSO,REGISTRO_ERROR,LOGIN_EXITOSO,LOGIN_ERROR,LOGOUT,OBTENER_USUARIO}from\"../../types\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),autenticado:null,usuario:null,mensaje:null};var _useReducer=useReducer(authReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// 1. Registra al nuevo usuario\nvar registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(datos){var resultado,alerta;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post(\"/users\",datos);case 3:resultado=_context.sent;// Estoy enviando el TOKEN\ndispatch({type:REGISTRO_EXITOSO,payload:resultado.data});usuarioAutenticado();_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);alerta={msg:_context.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:REGISTRO_ERROR,payload:alerta});case 12:case\"end\":return _context.stop();}},_callee,null,[[0,8]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();// 2. Retorna el usuario autenticado\nvar usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var token,respuesta;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem(\"token\");if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get(\"/auth\");case 5:respuesta=_context2.sent;dispatch({type:OBTENER_USUARIO,payload:respuesta.data});_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);dispatch({type:LOGIN_ERROR});case 12:case\"end\":return _context2.stop();}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();// 3. Iniciar Sesi贸n\nvar iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post(\"/auth\",datos);case 3:respuesta=_context3.sent;dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});// Traigo el usuario\nusuarioAutenticado();_context3.next=12;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);alerta={msg:_context3.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:LOGIN_ERROR,payload:alerta});case 12:case\"end\":return _context3.stop();}},_callee3,null,[[0,8]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();// 4. Cerrar Sesi贸n\nvar cerrarSesion=function cerrarSesion(){dispatch({type:LOGOUT});};return/*#__PURE__*/_jsx(authContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,registrarUsuario:registrarUsuario,usuarioAutenticado:usuarioAutenticado,iniciarSesion:iniciarSesion,cerrarSesion:cerrarSesion},children:props.children});};export default AuthState;","map":{"version":3,"names":["React","useReducer","authContext","authReducer","clienteAxios","tokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","LOGIN_EXITOSO","LOGIN_ERROR","LOGOUT","OBTENER_USUARIO","jsx","_jsx","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","_useReducer","_useReducer2","_slicedToArray","state","dispatch","registrarUsuario","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","datos","resultado","alerta","wrap","_callee$","_context","prev","next","post","sent","type","payload","data","usuarioAutenticado","t0","msg","response","categoria","stop","_x","apply","arguments","_ref2","_callee2","respuesta","_callee2$","_context2","get","iniciarSesion","_ref3","_callee3","_callee3$","_context3","_x2","cerrarSesion","Provider","value","children"],"sources":["/Users/usuario/Desktop/portfolio-aa/src/context/auth/authState.js"],"sourcesContent":["import React, { useReducer } from \"react\";\r\nimport authContext from \"./authContext\";\r\nimport authReducer from \"./authReducer\";\r\n\r\nimport clienteAxios from \"../../service/axios\";\r\n\r\nimport tokenAuth from \"../../config/token\";\r\n\r\nimport {\r\n  REGISTRO_EXITOSO,\r\n  REGISTRO_ERROR,\r\n  LOGIN_EXITOSO,\r\n  LOGIN_ERROR,\r\n  LOGOUT,\r\n  OBTENER_USUARIO,\r\n} from \"../../types\";\r\n\r\nconst AuthState = (props) => {\r\n  const initialState = {\r\n    token: localStorage.getItem(\"token\"),\r\n    autenticado: null,\r\n    usuario: null,\r\n    mensaje: null,\r\n  };\r\n\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n\r\n  // 1. Registra al nuevo usuario\r\n  const registrarUsuario = async (datos) => {\r\n    try {\r\n      const resultado = await clienteAxios.post(\"/users\", datos);\r\n\r\n      // Estoy enviando el TOKEN\r\n      dispatch({\r\n        type: REGISTRO_EXITOSO,\r\n        payload: resultado.data,\r\n      });\r\n\r\n      usuarioAutenticado();\r\n    } catch (error) {\r\n      const alerta = {\r\n        msg: error.response.data.msg,\r\n        categoria: \"alerta-error\",\r\n      };\r\n\r\n      dispatch({\r\n        type: REGISTRO_ERROR,\r\n        payload: alerta,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 2. Retorna el usuario autenticado\r\n  const usuarioAutenticado = async () => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      tokenAuth(token);\r\n    }\r\n\r\n    try {\r\n      const respuesta = await clienteAxios.get(\"/auth\");\r\n      dispatch({\r\n        type: OBTENER_USUARIO,\r\n        payload: respuesta.data,\r\n      });\r\n    } catch (error) {\r\n      dispatch({\r\n        type: LOGIN_ERROR,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 3. Iniciar Sesi贸n\r\n\r\n  const iniciarSesion = async (datos) => {\r\n    try {\r\n      const respuesta = await clienteAxios.post(\"/auth\", datos);\r\n\r\n      dispatch({\r\n        type: LOGIN_EXITOSO,\r\n        payload: respuesta.data,\r\n      });\r\n\r\n      // Traigo el usuario\r\n      usuarioAutenticado();\r\n    } catch (error) {\r\n      const alerta = {\r\n        msg: error.response.data.msg,\r\n        categoria: \"alerta-error\",\r\n      };\r\n\r\n      dispatch({\r\n        type: LOGIN_ERROR,\r\n        payload: alerta,\r\n      });\r\n    }\r\n  };\r\n\r\n  // 4. Cerrar Sesi贸n\r\n  const cerrarSesion = () => {\r\n    dispatch({\r\n      type: LOGOUT,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <authContext.Provider\r\n      value={{\r\n        token: state.token,\r\n        autenticado: state.autenticado,\r\n        usuario: state.usuario,\r\n        mensaje: state.mensaje,\r\n        registrarUsuario,\r\n        usuarioAutenticado,\r\n        iniciarSesion,\r\n        cerrarSesion,\r\n      }}\r\n    >\r\n      {props.children}\r\n    </authContext.Provider>\r\n  );\r\n};\r\n\r\nexport default AuthState;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}